이미지 최적화가 가능한 이유는

도커는 레이어 기반 아키텍처 이기 때문입니다.

이미지 빌드시 캐시를 남기는데

리빌드할때 캐시를 참조하여 이미지를 빌드합니다.

ex 02 에서 03 으로 변경하기 전 코드를 변경하고 리빌드를 할 경우에
하나의 레이어가 변경되면 나머지 레이어도 다시 빌드 되기 때문입니다.

그래서 package.json을 최상위로 빌드해 주고 리빌드 될 필요 없는 npm install을 바로 밑 line 으로 보냅니다.

그리고 변경된 COPY . /app 을 마지막으로 리빌드 해줌으로 써 빌드속도를 향상시킬 수 있습니다.